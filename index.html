<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />
  <title>Mojave UFO</title>

  <!-- Self-hosted Spline Viewer (your pinned file is fine) -->
  <script type="module" src="./vendor/spline-viewer/build/spline-viewer.js"></script>

  <style>
    /* Base: full-bleed canvas, no default traps */
    html, body { margin: 0; height: 100%; background: transparent; }

    /* EMBED mode must allow internal scroll (critical) */
    html.embed, body.embed {
      overflow-y: auto;           /* ensure the iframe document can scroll */
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }

    /* Sticky canvas: stays pinned while the spacer provides scroll distance */
    #wrap {
      position: sticky;
      top: 0;
      height: 100vh;              /* keep the viewer in view while we scroll */
    }

    /* Viewer fills its wrapper */
    spline-viewer {
      display: block;
      width: 100%;
      height: 100%;
    }

    /* The only flow-height provider */
    #ghost-scroll { width: 1px; height: 0; }
  </style>
</head>
<body>
  <div id="wrap">
    <!-- Use valid events-target values -->
    <spline-viewer
      url="./scene.splinecode"
      events-target="global"
      loading="eager"
    ></spline-viewer>
  </div>

  <!-- Spacer that defines the exact scroll budget in EMBED mode -->
  <div id="ghost-scroll" aria-hidden="true"></div>

  <script>
    const qs = new URLSearchParams(location.search);
    const isEmbedded = qs.get("external") === "1" || window.self !== window.top;

    if (isEmbedded) {
      document.documentElement.classList.add("embed");
      document.body.classList.add("embed");
    }

    // Calibrated scroll budget (pixels); Spline's Scroll Event uses px
    const userPx   = Number(qs.get("scrollpx"));
    const isPhone  = /Mobi|Android/i.test(navigator.userAgent);
    const fallback = isPhone ? 900 : 1200;   // tune once, then pass &scrollpx when needed
    const scrollBudgetPx = Number.isFinite(userPx) ? userPx : fallback;

    if (isEmbedded) {
      const ghost = document.getElementById("ghost-scroll");
      ghost.style.height = Math.max(0, scrollBudgetPx) + "px";
    }
  </script>
</body>
</html>
