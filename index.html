<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mojave UFO</title>
    <link rel="preload" as="image" href="./poster.png" />
    <style>
      html, body { height: 100%; margin: 0; background: transparent; }
      /* Stabilize mobile viewport height to avoid early reflows */
      @supports (height: 100svh) {
        html, body { height: 100svh; min-height: 100svh; }
      }
      #wrap { position: relative; width: 100vw; height: 100vh; overflow: hidden; background: transparent; }
      #poster { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; background: transparent; }
      spline-viewer { position: absolute; inset: 0; display: block; width: 100%; height: 100%; background: transparent !important; }
      .hidden { display: none !important; }
    </style>
    <!-- Import ONLY the Spline viewer (no standalone Three.js) -->
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.57/build/spline-viewer.js"></script>
  </head>
  <body>
    <div id="wrap">
      <img id="poster" src="./poster.png" alt="Mojave UFO" />
      <spline-viewer
        id="sv"
        url="./scene.splinecode"
        background="transparent"
        loading-anim="true"
        events-target="local"
        aria-label="Spline scene"
      ></spline-viewer>
    </div>

    <script type="module">
      // Handle context loss/restoration gracefully + poster hide
      const sv = document.getElementById('sv')
      const poster = document.getElementById('poster')
      const hidePoster = () => poster && poster.classList.add('hidden')

      // Robust first-frame sequence at t=0
      const onLoad = () => {
        try { sv.pause?.() } catch {}
        try { sv.setTime?.(0) } catch {}
        try { sv.render?.() } catch {}
        requestAnimationFrame(() => {
          try { sv.setTime?.(0) } catch {}
          hidePoster()
          // start slightly later to avoid mid-tick on slow devices
          setTimeout(() => {
            try { sv.play?.() } catch {}
            try { sv.setTime?.(0) } catch {}
          }, 120)
        })
      }
      sv?.addEventListener('load-complete', onLoad)
      // Fallback in case event name changes
      sv?.addEventListener('load', onLoad)
      // Extra safety so poster never sticks
      setTimeout(hidePoster, 6000)
      sv?.addEventListener('context-loss', () => {
        const u = sv.getAttribute('url')
        sv.setAttribute('url', '')
        requestAnimationFrame(() => sv.setAttribute('url', u))
      })
    </script>
  </body>
  </html>
