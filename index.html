<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Mojave UFO</title>

    <!-- Load Spline viewer web component -->
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.53/build/spline-viewer.js"></script>

    <!-- Preload both variants so the chosen one appears faster -->
    <link rel="preload" href="./scene-desktop.splinecode" as="fetch" crossorigin="anonymous" />
    <link rel="preload" href="./scene-mobile.splinecode" as="fetch" crossorigin="anonymous" />

    <style>
      html, body { margin: 0; height: 100%; background: #000; }
      /* Width-driven, ratio-based box to avoid mobile 100vh jumpiness */
      #box {
        position: relative;
        width: 100vw;
        aspect-ratio: 1200 / 700; /* height = width / (1200/700) */
        max-height: 100dvh;
        background: #000;
        overflow: hidden;
      }
      /* Fallback for browsers without dvh support */
      @supports not (height: 100dvh) {
        #box { max-height: 100vh; }
      }
      spline-viewer {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        display: block;
      }
      /* Optional: poster overlay for instant first paint (replace poster.png) */
      #poster {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        pointer-events: none;
        transition: opacity 160ms ease;
      }
    </style>
  </head>
  <body>
    <div id="box">
      <!-- Replace with a real exported poster matching frame 0 -->
      <img id="poster" src="./poster.png" alt="" />
    </div>

    <script>
      (function () {
        const MOBILE_BP = 768
        const box = document.getElementById('box')
        const viewer = document.getElementById('viewer')
        const poster = document.getElementById('poster')

        function chooseUrl(width) {
          return width <= MOBILE_BP ? './scene-mobile.splinecode' : './scene-desktop.splinecode'
        }

        let current = ''
        function mountViewer(url) {
          if (!box) return
          const old = document.getElementById('viewer')
          const el = document.createElement('spline-viewer')
          el.setAttribute('id', 'viewer')
          el.setAttribute('url', url)
          // Insert below poster so poster stays on top until we fade it
          box.insertBefore(el, poster || null)
          if (old && old !== el) try { old.remove() } catch (_) {}

          // Best-effort poster fade after the element has a couple paint cycles
          hidePosterSoon()
        }

        function updateUrl() {
          const w = (box && box.clientWidth) || window.innerWidth || 1024
          const next = chooseUrl(w)
          if (next !== current) {
            current = next
            mountViewer(next)
          }
        }

        // Fade poster after first paint from the viewer (best-effort)
        function hidePosterSoon() {
          if (!poster) return
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              poster.style.opacity = '0'
              setTimeout(() => { try { poster.remove() } catch (_) {} }, 220)
            })
          })
        }

        // Initial selection and responsive switching at breakpoint
        updateUrl()
        if ('ResizeObserver' in window && box) {
          const ro = new ResizeObserver(() => updateUrl())
          ro.observe(box)
        } else {
          window.addEventListener('resize', updateUrl)
          window.addEventListener('orientationchange', updateUrl)
        }
      })()
    </script>
  </body>
  </html>
