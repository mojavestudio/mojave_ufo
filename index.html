<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Self-hosted Spline Wrapper</title>
    <style>
      html, body { margin: 0; height: 100%; background: transparent; }
      #spline-host { position: relative; width: 100%; height: 100%; }
      #splineIF { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; display: block; overflow: hidden; background: transparent; }
    </style>
  </head>
  <body>
    <div id="spline-host" style="position:relative;width:100%;height:100%;">
      <iframe
        id="splineIF"
        src="./scene.html"
        title="Self-hosted Spline"
        allow="fullscreen; autoplay; xr-spatial-tracking"
        loading="lazy"
        style="position:absolute;inset:0;width:100%;height:100%;border:0;display:block;overflow:hidden;background:transparent"
        allowtransparency="true">
      </iframe>
    </div>

    <script>
      (function () {
        const host = document.getElementById('spline-host');
        const ifr  = document.getElementById('splineIF');

        // Section-based progress: 0..1 as this Embed scrolls through the viewport
        function computeT() {
          const r  = host.getBoundingClientRect();
          const vh = window.innerHeight || 1;
          const denom = Math.max(1, r.height - vh);
          let t = (0 - r.top) / denom;
          return t < 0 ? 0 : t > 1 ? 1 : t;
        }

        let ticking = false;
        function send() {
          if (!ifr?.contentWindow) return;
          ifr.contentWindow.postMessage({ type: 'FRAMER_SCROLL', t: computeT() }, '*');
        }
        function onScrollOrResize() {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => { ticking = false; send(); });
        }
        function onLoad() {
          ifr.contentWindow?.postMessage({ type: 'FRAMER_SCROLL_INIT' }, '*');
          send();
        }

        ifr.addEventListener('load', onLoad);
        addEventListener('scroll', onScrollOrResize, { passive: true });
        addEventListener('resize', onScrollOrResize);
        send(); // kick once
      })();
    </script>
  </body>
  </html>
