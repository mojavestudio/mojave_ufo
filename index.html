<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <script type="module" src="./vendor/spline-viewer/build/spline-viewer.js"></script>
  <style>
    html, body { margin:0; height:100%; background:transparent; }
    /* Prefer svh to avoid mobile URL bar jumps */
    #outer  { position:relative; height:180svh; }
    #sticky { position:sticky; top:0; height:100svh; }
    spline-viewer { width:100%; height:100%; display:block; }

    @supports not (height: 100svh) {
      /* Fallback handled by JS (visualViewport) */
      #outer  { height:auto; }
      #sticky { height:100vh; }
    }

    /* Hide scrollbars but keep scrolling (cross-browser) */
    html, body { -ms-overflow-style: none; scrollbar-width: none; }
    html::-webkit-scrollbar, body::-webkit-scrollbar { width: 0; height: 0; display: none; }
  </style>
</head>
<body>
  <section id="outer">
    <div id="sticky">
      <spline-viewer id="viewer" url="./scene.splinecode" events-target="local"></spline-viewer>
    </div>
  </section>

  <script type="module">
    const qp = new URLSearchParams(location.search);
    const outer = document.getElementById('outer');

    function applyHeight() {
      const px = parseInt(qp.get('scrollpx') || '0', 10);
      if (px) {
        outer.style.height = px + 'px';
        return;
      }
      const vh = parseFloat(qp.get('scrollvh') || '170');
      const unit = (window.visualViewport?.height || window.innerHeight) / 100;
      outer.style.height = (vh * unit) + 'px';
    }

    // Only apply JS fallback if svh unsupported or query params present
    const needsJS = !CSS.supports('height', '100svh') || qp.has('scrollvh') || qp.has('scrollpx');
    if (needsJS) {
      applyHeight();
      window.visualViewport?.addEventListener('resize', applyHeight);
      window.addEventListener('orientationchange', applyHeight);
      window.addEventListener('resize', applyHeight);
    }

    if (qp.get('external') === '1') {
      window.addEventListener('message', (e) => {
        if (!e?.data || e.data.type !== 'SCROLL_PROGRESS') return;
        const max = document.documentElement.scrollHeight - innerHeight;
        document.documentElement.scrollTop = e.data.progress * Math.max(0, max);
      });
    }
  </script>
</body>
</html>
