<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Mojave UFO</title>

  <!-- Pinned self-hosted viewer is fine -->
  <script type="module" src="./vendor/spline-viewer/build/spline-viewer.js"></script>

  <style>
    /* Base */
    html, body { margin: 0; height: 100%; background: transparent; }

    /* EMBED mode: allow internal scroll for Scroll Event progress */
    html.embed, body.embed {
      overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }

    /* Sticky viewer stays in view while page scrolls through spacer */
    #wrap { position: sticky; top: 0; height: 100vh; }

    spline-viewer { display: block; width: 100%; height: 100%; }

    /* Precise scroll budget - matches Spline "End After" pixels */
    #ghost-scroll { width: 1px; height: 0; }
  </style>
</head>
<body>
  <div id="wrap">
    <spline-viewer
      url="./scene.splinecode"
      events-target="global"
      loading="eager"
    ></spline-viewer>
  </div>

  <!-- Spacer provides exact scroll distance for Spline Scroll Event -->
  <div id="ghost-scroll" aria-hidden="true"></div>

  <script>
    const qs = new URLSearchParams(location.search);
    const isEmbedded = qs.get("external") === "1" || window.self !== window.top;

    if (isEmbedded) {
      document.documentElement.classList.add("embed");
      document.body.classList.add("embed");

      // Parse scroll budget - must match your Spline scene's "End After" values
      const userPx = Number(qs.get("scrollpx"));
      const isPhone = /Mobi|Android/i.test(navigator.userAgent);
      const fallback = isPhone ? 900 : 1200;  // tune to match your scene
      const scrollBudgetPx = Number.isFinite(userPx) ? userPx : fallback;

      const ghost = document.getElementById("ghost-scroll");
      ghost.style.height = Math.max(0, scrollBudgetPx) + "px";
    }

    // Clear any leftover overflow locks from previous versions
    document.documentElement.style.overflow = "";
    document.body.style.overflow = "";
  </script>
</body>
</html>
