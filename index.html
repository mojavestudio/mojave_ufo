<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mojave UFO</title>

  <!-- Use CDN first; vendor later if desired -->
  <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.57/build/spline-viewer.js"></script>

  <style>
    /* Full-bleed viewer; child won't capture scroll (parent controls scroll) */
    html, body { height: 100%; margin: 0; background: transparent; overflow: hidden; }
    #wrap { position: fixed; inset: 0; }
    spline-viewer, canvas { width: 100% !important; height: 100% !important; display: block; background: transparent !important; }
  </style>
</head>
<body>
  <div id="wrap">
    <spline-viewer id="sv" url="./scene.splinecode" events-target="window" loading-anim="true"></spline-viewer>
  </div>
  <!-- Invisible scroller to provide scrollHeight for Spline Scroll Events (no user scroll) -->
  <div id="ghost-scroll" style="height:4000px; visibility:hidden; pointer-events:none;"></div>

  <script>
    (function () {
      const sv = document.getElementById('sv');

      // Play when loaded; ensure t=0 for a clean first frame
      sv?.addEventListener?.('load-complete', () => {
        try { sv.play?.(); sv.setTime?.(0); } catch {}
      });

      // Receive parent scroll messages: scrub timeline and emulate child scroll (no user scroll)
      addEventListener('message', (e) => {
        const d = e?.data || {};
        if (d.type === 'FRAMER_SCROLL_INIT') {
          try { sv.pause?.(); sv.setTime?.(0); } catch {}
          return;
        }
        if (d.type === 'FRAMER_SCROLL') {
          const t = Math.max(0, Math.min(1, Number(d.t) || 0));
          try {
            const dur = Number(sv?.duration || 1);
            sv.setTime?.(t * dur);
            sv.play?.();
          } catch {}
          // Emulate internal scroll so Spline Scroll Events fire, without stealing page scroll
          try {
            const max = Math.max(1, document.documentElement.scrollHeight - innerHeight);
            scrollTo(0, t * max);
          } catch {}
        }
      });

      // Safety: if viewer never registers, script didn’t load
      setTimeout(() => {
        if (!customElements.get('spline-viewer')) {
          console.warn('spline-viewer not registered — check <script src> or CSP');
        }
      }, 4000);
    })();
  </script>
</body>
</html>
