<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />
  <title>Mojave UFO</title>

  <!-- Pinned self-hosted viewer is fine -->
  <script type="module" src="./vendor/spline-viewer/build/spline-viewer.js"></script>

  <style>
    /* Base */
    html, body { margin: 0; height: 100%; background: transparent; }

    /* âœ… EMBED MODE: iframe document MUST be scrollable */
    html.embed, body.embed {
      overflow-y: auto;               /* <-- never hidden */
      overscroll-behavior: contain;   /* avoid chaining/bounce */
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }

    /* Keep the viewer visible while the page scrolls past a spacer */
    #wrap { position: sticky; top: 0; height: 100vh; }

    spline-viewer { display: block; width: 100%; height: 100%; }

    /* The ONLY flow-height provider in embed mode */
    #ghost-scroll { width: 1px; height: 0; }
  </style>
</head>
<body>
  <div id="wrap">
    <spline-viewer
      url="./scene.splinecode"
      events-target="global"   <!-- valid values: local | global -->
      loading="eager"
    ></spline-viewer>
  </div>

  <!-- precise scroll budget lives OUTSIDE the sticky viewer -->
  <div id="ghost-scroll" aria-hidden="true"></div>

  <script>
    const qs = new URLSearchParams(location.search);
    const isEmbedded = qs.get("external") === "1" || window.self !== window.top;

    if (isEmbedded) {
      document.documentElement.classList.add("embed");
      document.body.classList.add("embed");

      // Parse & apply scroll budget in pixels for Spline Scroll Event
      const userPx = Number(qs.get("scrollpx"));
      const isPhone = /Mobi|Android/i.test(navigator.userAgent);
      const fallback = isPhone ? 900 : 1200;  // adjust once if needed
      const px = Number.isFinite(userPx) ? userPx : fallback;

      const ghost = document.getElementById("ghost-scroll");
      ghost.style.height = Math.max(0, px) + "px";
    }
  </script>
</body>
</html>
