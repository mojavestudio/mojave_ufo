<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Mojave UFO</title>

    <!-- Warm up connections -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="preconnect" href="https://mojavestudio.github.io" crossorigin>
    <link rel="dns-prefetch" href="https://mojavestudio.github.io">

    <!-- Preload the Spline viewer module + assets -->
    <link rel="modulepreload" href="https://unpkg.com/@splinetool/viewer@1.10.53/build/spline-viewer.js">
    <link rel="preload" as="fetch" href="./scene.splinecode" crossorigin>

    <!-- We'll use the official Runtime instead of the web component for reliability -->
    <link rel="preload" as="fetch" href="https://unpkg.com/@splinetool/runtime@1.10.56/build/runtime.js" crossorigin>

    <style>
      html, body { margin: 0; background: #000; }
      /* Ratio sizer reserves height on first paint; no mobile shrink */
      #frame { position: relative; width: 100vw; max-width: 100%; background: #000; overflow: hidden; margin: 0 auto; }
      #frame::before { content: ""; display: block; padding-top: 58.333333%; }
      #content { position: absolute; inset: 0; }
      canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; background: transparent; }
      #debug { position: fixed; left: 8px; bottom: 8px; padding: 6px 8px; border-radius: 6px; background: rgba(0,0,0,.6); color: #0f0; font: 12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; z-index: 9999; }
    </style>
  </head>
  <body>
    <div id="frame">
      <div id="content">
        <canvas id="canvas" aria-label="Spline"></canvas>
      </div>
    </div>
    <div id="debug" hidden>â€”</div>

    <script type="module">
      // Minimal, robust Runtime loader with responsive sizing
      const d = document.getElementById('debug')
      const log = (t) => { try { d.hidden = false; d.textContent = t } catch {} }
      const frame = document.getElementById('frame')
      const canvas = document.getElementById('canvas')
      const SCENE = './scene.splinecode'

      function sizeCanvas() {
        if (!frame || !canvas) return
        const w = Math.max(1, Math.round(frame.clientWidth))
        const h = Math.max(1, Math.round(frame.clientHeight))
        const dpr = Math.min(window.devicePixelRatio || 1, 1.5)
        canvas.style.width = w + 'px'
        canvas.style.height = h + 'px'
        canvas.width = Math.round(w * dpr)
        canvas.height = Math.round(h * dpr)
        try { app?.setSize?.(w, h) } catch {}
      }

      let app = null
      (async () => {
        try {
          const { Application } = await import('https://unpkg.com/@splinetool/runtime@1.10.56/build/runtime.js')
          app = new Application(canvas, { /* use CDN for wasm by default */ })
          sizeCanvas()
          await app.load(SCENE)
          // Lock first frame then play
          try { app.stop?.(); app.setTime?.(0) } catch {}
          await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)))
          try { app.play?.() } catch {}
        } catch (e) {
          log('Load error: ' + (e?.message || e))
        }
      })()

      // Keep canvas responsive (no reloads)
      if ('ResizeObserver' in window && frame) {
        const ro = new ResizeObserver(sizeCanvas)
        ro.observe(frame)
      } else {
        window.addEventListener('resize', sizeCanvas)
        window.addEventListener('orientationchange', sizeCanvas)
      }
    </script>
  </body>
  </html>
